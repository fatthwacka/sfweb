<!DOCTYPE html>
<html>
<head>
    <title>Debug Image Optimization</title>
</head>
<body>
    <h1>Testing Image Optimization</h1>
    <div id="results"></div>
    
    <script>
    function getOptimizedImageUrl(originalUrl, options = {}) {
        console.log('INPUT URL:', originalUrl);
        
        if (!originalUrl) return originalUrl;
        
        // Check if it's a Supabase storage URL
        if (!originalUrl.includes('supabase') || !originalUrl.includes('/storage/v1/object/public/')) {
            console.log('NOT SUPABASE URL');
            return originalUrl;
        }
        
        // If no transformations specified, return original
        if (Object.keys(options).length === 0) {
            console.log('NO OPTIONS PROVIDED');
            return originalUrl;
        }
        
        // Extract the path after /storage/v1/object/public/
        const publicPathMatch = originalUrl.match(/\/storage\/v1\/object\/public\/(.+)$/);
        if (!publicPathMatch) {
            console.log('REGEX FAILED');
            return originalUrl;
        }
        
        const imagePath = publicPathMatch[1];
        const baseUrl = originalUrl.replace(/\/storage\/v1\/object\/public\/.+$/, '');
        
        console.log('IMAGE PATH:', imagePath);
        console.log('BASE URL:', baseUrl);
        
        // Build transformation parameters
        const params = new URLSearchParams();
        if (options.width) params.append('width', options.width.toString());
        if (options.height) params.append('height', options.height.toString());
        if (options.quality) params.append('quality', options.quality.toString());
        if (options.format) params.append('format', options.format);
        if (options.resize) params.append('resize', options.resize);
        
        console.log('PARAMS:', params.toString());
        
        // Use Supabase render API for transformations
        const result = `${baseUrl}/storage/v1/render/image/public/${imagePath}?${params.toString()}`;
        console.log('FINAL RESULT:', result);
        return result;
    }
    
    // Test with actual URL
    const testUrl = 'https://dwkjfuhykdjtzvrzdnrr.supabase.co/storage/v1/object/public/gallery-images/shoots/af6a630a-bfe1-4b3e-a10b-98ef15b773dc/1753626698807_lvdx91jsg4.jpg';
    const options = { width: 2400, height: 2400, quality: 80, resize: 'contain' };
    
    const optimized = getOptimizedImageUrl(testUrl, options);
    
    document.getElementById('results').innerHTML = `
        <p><strong>Original:</strong> ${testUrl}</p>
        <p><strong>Optimized:</strong> ${optimized}</p>
        <p><strong>Is Different:</strong> ${optimized !== testUrl}</p>
        <p><strong>Has Render Path:</strong> ${optimized.includes('/render/image/')}</p>
    `;
    </script>
</body>
</html>